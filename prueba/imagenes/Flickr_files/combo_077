YUI.add("hermes-template-editor-upgrade-dialog",function(e,a){var t=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,t,s,i){var r=null!=a?a:{},n=t.helperMissing,l=e.escapeExpression;return'<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n\t<div class="ui-dialog-description js-description">\n\t\t<h3>'+l((t.intlMessage||a&&a.intlMessage||n).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.EDITOR_UPGRADE"},data:i}))+"</h3>\n\t\t<br>\n\t\t"+l((t.intlHTMLMessage||a&&a.intlHTMLMessage||n).call(r,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.EDITOR_UPGRADE_MESSAGE"},data:i}))+"\n\t</div>\n</div>\n"},useData:!0}),s={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(s[a]=t)}),e.Template.register("hermes/editor-upgrade-dialog",function(a,i){return i=i||{},i.partials=i.partials?e.merge(s,i.partials):s,t(a,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-scrappy-edit-view",function(e,t){var o=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.backToURL=e.backToURL,this.context=e.context,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("scrappy-edit-button",{loadingView:!0}),this.editorParams={nsid:this.nsid,photoId:this.photoId,backToURL:this.backToURL},this},loadState:function(){var t=this;return this.appContext.getViewer().signedIn?e.Promise.all([this.appContext.getModel("photo-models",t.photoId)]).then(function(o){var i=o[0];if(t.set("photo",i),i.getValue("owner").getValue("isMe")&&!t.appContext.forceServerRender)return t.appContext.getModel(t.context.modelName,t.context.params).then(function(e){t.set("contextModel",e)}).then(function(){var o=e.merge(t.context.params,{photoId:t.photoId,numNext:1,numPrev:1});return t.get("contextModel").getValue("photoContextList").getContext(o).then(function(){var e,o=t.get("contextModel").getValue("photoContextList").getList(),i=o.length;(e=o.map(function(e){return e.getValue("id")}).indexOf(t.photoId))>=0&&e<i&&t.set("nextPhotoModel",o[e+1]),e>0&&t.set("prevPhotoModel",o[e-1])})})}):e.Promise.resolve()},buildContainer:function(){var e=!1;return this.appContext.getViewer().signedIn&&(e=this.get("photo").getValue("owner").getValue("isMe")),this.setContainerWithTemplate("scrappy-edit-button",{viewerIsOwner:e}),this},activate:function(){var e=this.get("container");return e&&this.registerEventHandler(e.on("click",this.handleMenuButtonClick,this)),this},setupDropdown:function(t){var o,i,a=this.get("container"),n=this.get("photo"),l=n.getValue("owner").getValue("isMe"),s=!1,r=this,h=n.getValue("isVideo"),c=n.getValue("id");l&&(s=!0),o=e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias")}),i=this.templates("scrappy-edit-menu")({photoURL:o,photoId:c,viewerIsOwner:l,showDeleteLink:l,showRotateLink:l&&!h,showReplaceLink:l&&!h,isVideo:h,showEditLink:l&&!h,enableEdit:s}),this.editMenu&&(this.editMenu.close(),this.editMenu=null),this.editMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,preferTop:!0,showDropArrow:!0,anchorOffsetHorizontal:3,anchorOffsetVertical:10,anchorElement:a.one(".edit"),htmlMessage:i,closeOnScroll:!1,classList:"dialog-tooltip",hideModalOverlay:!0,autoSizeToContent:!0}),this.editMenu.on("activated",function(o){r.fire("subviewViewEvent","make in view",a),e.use("photo-editor-view",function(){t()})}),this.editMenu.on("closeDroparound",function(e){r.fire("subviewViewEvent","close in view")}),this.editMenu.show()},handleMenuButtonClick:function(t){var o=this;t.preventDefault(),e.rapidTracker.beacon(this.name,"editMenuClick"),this.appContext.experiments.fullscreen.getMode()||this.setupDropdown(function(){var e={},t=o.editMenu.get("container");o.appContext.auth.signedIn&&(e.deleteMenuItem=t.one(".delete-photo"),e.deleteMenuItem&&e.deleteMenuItem.on("click",o.handleDeletePhotoClick,o),e.rotateMenuItem=t.one(".rotate-photo"),e.rotateMenuItem&&e.rotateMenuItem.on("click",o.handleRotatePhotoClick,o),e.replaceMenuItem=t.one(".replace-photo"),e.replaceMenuItem&&e.replaceMenuItem.on("click",o.handleReplacePhotoClick,o),e.editorMenuItem=t.one(".edit-photo"),e.editorMenuItem&&e.editorMenuItem.on("click",o.handleEditClick,o))})},handleDeletePhotoClick:function(t){t.preventDefault();var o;this.editMenu.close(),(o=new e.Views.FluidModal({title:this.intlMessage({intlName:"photo-page-scrappy.DELETE_PHOTO"}),actionButtonLabel:this.intlMessage({intlName:"common.DELETE"}),actionButtonIsDangerous:!0,htmlMessage:this.intlMessage({intlName:"photo-page-scrappy.PERMANTENTLY_DELETE"}),appContext:this.appContext,dismissOnOverlayClick:!1,dismissOnActionClick:!0,classList:"scrappy-dialog",actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",this.handleDeletePhotoConfirmClick.bind(this)),o.show(),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleDeletePhotoConfirmClick:function(t){var o,i=this,a=i.get("photo").getValue("owner"),n=i.get("nextPhotoModel"),l=i.get("prevPhotoModel");e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),i.deleteDialog&&i.deleteDialog.close(),this.appContext.callAPI("flickr.photos.delete",{photo_id:this.photoId}).then(function(t){o=n?e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):l?e.URLHelper.getPhotoPage({photoId:l.getValue("id"),pathAlias:l.getValue("owner").getValue("pathAlias"),contextSuffix:i.get("contextModel").getValue("urlSuffix")}):a.getValue("url")+"?deleted="+i.photoId,e.config.win.location=o},function(e){i.showErrorDialog(i.intlMessage({intlName:"photo-page-scrappy.ERROR_DELETING_PHOTO"}))})},handleReplacePhotoClick:function(t){t.halt();var o=this;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.replaceDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("replace-photo-dialog-content")(),classList:"scrappy-dialog dialog-modal",showCancelX:!0,dismissOnOverlayClick:!0,showHeader:!1,showFooter:!1,width:700}),this.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];t&&(o._imgFile=t,o.replaceConfirm())},":submit":function(){o.replaceSubmit()}}),this.replaceDialog.on("close",function(){o._imgFileXhr&&o._imgFileXhr.abort(),o._imgFileXhr=null,o._imgFile=null,this.replaceDialog=null}),this.replaceDialog.show(),e.rapidTracker.beacon(this.name,"replacePhotoClick"))},replaceConfirm:function(){this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t,i,a,n,l,s=new FormData,r=this,h=e.config.flickr.api.hostname_client_replace;s.append("api_key",e.config.flickr.api.site_key),s.append("csrf",e.config.flickr.csrf.token),s.append("photo",this._imgFile,this._imgFile.name),s.append("photo_id",this.photoId),(t=this._imgFileXhr=new XMLHttpRequest).open("POST",h,!0),t.withCredentials=!0,n=function(i){var a="object"==typeof i?i.target.statusText:i+"",n="ERROR_REPLACING_PHOTO";r.replaceDialog.close(),t.statusText.indexOf("Filetype was not recognised")>0&&(n="ERROR_REPLACING_PHOTO_FILE_TYPE"),r.showErrorDialog(r.intlMessage({intlName:"photo-page-scrappy."+n})),e.config.win.beaconError("Replace error",window.location.href,{err:i,status:t.statusText}),o.error("error during upload",{statusText:a})},l=function(o){var i,a,l;try{(l=document.createElement("div")).innerHTML=o.target.responseText,(a=l.getElementsByTagName("rsp")[0]||"")&&(a=a.getAttribute("stat")||""),(i=l.getElementsByTagName("err")[0]||"")&&(i=i.getAttribute("msg")||"")}catch(e){a="",i=""}if("ok"!==a)return e.config.win.beaconError("Replace error from API response",window.location.href,{err:o.target.responseText,status:t.statusText}),n((a||"empty")+": "+(i||"no message"));r.replaceDialog.close(),window.location.reload()},this.replaceDialog.set("htmlMessage",this.templates("replace-photo-dialog-content")({fileName:this._imgFile.name,uploading:!0})),this.replaceDialog.buildContainer(),this.replaceDialog.activate(),a=this.replaceDialog.get("container").one("progress"),t.addEventListener("load",l),t.addEventListener("error",n),t.upload.addEventListener("progress",function(e){a.value=i=Math.floor(e.loaded/e.total*100),e.loaded===e.total&&a.removeAttribute("value")}),t.send(s)},handleRotatePhotoClick:function(t){t.halt();var o=this;this.get("photo").getValue("isVideo")||(this.editMenu.close(),this.rotateDialog=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("rotate-photo-dialog-content")({preview:o.get("photo").getSizeToFit({width:240,height:240})}),dismissOnOverlayClick:!0,showFooter:!1,showHeader:!1,showCancelX:!0,width:700,classList:"scrappy-dialog dialog-modal"}),this.rotateDialog.attachEvents({":select":function(t,i){t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),o._imgRotation=e.flutil.constrainToValues(i.rotation,["90","180","270"])},":submit":function(){o.rotateSubmit()}}),this.rotateDialog.on("close",function(){o.rotateDialog=null}),this.rotateDialog.show(),e.rapidTracker.beacon(this.name,"rotatePhotoClick"))},rotateSubmit:function(){var t,i=this,a=this.rotateDialog;a&&a.get("container")&&(t=a.get("container").one(".ui-dialog-buttonbar"))&&(t.addClass("loading"),t.append(this.templates("flickr-balls")({}))),this.appContext.callAPI("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation||90}).then(function(){setTimeout(function(){a.close(),i.fire("subviewViewEvent","photo:reload")},2e3)},function(n){a&&a.get("container")&&(t=a.get("container").one(".ui-dialog-buttonbar"))&&t.removeClass("loading"),a.close(),i.showErrorDialog(i.intlMessage({intlName:"photo-page-scrappy.ERROR_ROTATING_PHOTO"})),e.config.win.beaconError("Rotation error",window.location.href,n),o.error("error during rotation",{err:n})}),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick")},handleEditClick:function(t){t.halt(),this.editMenu.close(),this.appContext.flipper.isFlipped("enable-new-photo-editor")?(this.appContext.getView("photo-editor-view",this.editorParams).then(function(e){return e.initialize().then(function(){e.activate()})}),e.rapidTracker.beacon(this.name,"editPhoto")):(this.editorMenu=new e.Views.FluidModal({appContext:this.appContext,htmlMessage:this.templates("editor-upgrade-dialog")(),classList:"scrappy-dialog dialog-modal",showCancelX:!0,dismissOnOverlayClick:!0,showHeader:!1,showFooter:!0,showCancelButton:!1,width:600}),this.editorMenu.show())},showErrorDialog:function(t){return this.errorDialog=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,darkOverlay:!0}),this.errorDialog.show(),this.errorDialog}})},"@VERSION@",{requires:["flickr-view","flutil","hermes-template-dialog-cta-reboot","flickr-promise","fluid-modal-view","fluid-droparound-view","hermes-template-scrappy-edit-button","hermes-template-scrappy-edit-menu","hermes-template-replace-photo-dialog-content","hermes-template-rotate-photo-dialog-content","hermes-template-flickr-balls","hermes-template-editor-upgrade-dialog"],optional:[],langBundles:["common","photo-page-scrappy","photo-editor"]});YUI.add("hermes-lang-photo-editor_es-us",function(a,E){a.Intl.add("hermes/photo-editor","es-US",{FILTERS:["Filtros"],ORIENTATION:["Orientación"],ADJUST:["Ajustar"],CROP:["Cortar"],FOCUS:["Enfocar"],SELECTIVE_BLUR:["Desenfoque selectivo"],BORDER:["Borde"],STICKER:["Sticker"],TEXT:["Texto"],BRUSH:["Pincel"],FRAMES:["Marcos"],BORDER_COLOR:["Color"],BORDER_THICKNESS:["Grosor"],TEXT_FOREGROUND:["Primer plano"],TEXT_BACKGROUND:["Fondo"],TEXT_SIZE:["Tamaño"],TEXT_FONT:["Fuente"],TEXT_ALIGNMENT:["Alineación"],TEXT_TO_FRONT:["Al frente"],TEXT_DEFAULT_TEXT:["Clic para editar"],ORIENTATION_MINUS_90:["Rotar -90°"],ORIENTATION_PLUS_90:["Rotar +90°"],ORIENTATION_FLIP_H:["Voltear (H)"],ORIENTATION_FLIP_V:["Voltear (V)"],ADJUSTMENTS_BRIGHTNESS:["Brillo"],ADJUSTMENTS_CONTRAST:["Contraste"],ADJUSTMENTS_SATURATION:["Saturación"],ADJUSTMENTS_EXPOSURE:["Exposición"],ADJUSTMENTS_SHADOWS:["Sombras"],ADJUSTMENTS_HIGHLIGHTS:["Luces"],ADJUSTMENTS_CLARITY:["Nitidez"],ADJUSTMENTS_GAMMA:["Gamma"],CROP_CUSTOM:["Personalizado"],CROP_SQUARE:["Cuadrado"],CROP_4_3:["4:3"],CROP_16_9:["16:9"],CROP_NONE:["Ninguno"],CROP_ROTATION:["Rotación"],FOCUS_RADIAL:["Radial"],FOCUS_LINEAR:["Lineal"],FOCUS_BLUR_RADIUS:["Radio desenfocado"],FOCUS_NONE:["Ninguno"],FILTERS_INTENSITY:["Intensidad"],FILTERS_CATEGORIES_ALL:["TODO"],FILTERS_CATEGORIES_RETRO:["RETRO"],FILTERS_CATEGORIES_BW:["Blanco y negro"],FILTERS_CATEGORIES_SUMMER:["Verano"],FILTERS_CATEGORIES_WINTER:["Invierno"],FILTERS_CATEGORIES_SPECIAL:["Especial"],STICKERS_BRIGHTNESS:["Brillo"],STICKERS_CONTRAST:["Contraste"],STICKERS_SATURATION:["Saturación"],STICKERS_BLUR:["Desenfocado"],STICKERS_FLIP:["Voltear"],STICKERS_FLIP_V:["Voltear (V)"],STICKERS_FLIP_H:["Voltear (H)"],STICKERS_TO_FRONT:["Al frente"],STICKERS_CATEGORIES_ALL:["Todo"],STICKERS_CATEGORIES_GLASSES:["Lentes"],STICKERS_CATEGORIES_HATS:["Sombreros"],STICKERS_CATEGORIES_BEARDS:["Barbas"],STICKERS_CATEGORIES_MISC:["Varios"],BRUSH_THICKNESS:["Grosor"],BRUSH_COLOR:["Color"],WEBCAM_TAKE_PHOTO:["¡Toma una foto!"],EDITOR_EDIT_PHOTO:["Editar foto"],EDITOR_NEW:["Nuevo"],EDITOR_PHOTO_ROLL:["Galería"],EDITOR_UNDO:["Deshacer"],EDITOR_EXPORT:["Guardar"],EDITOR_ZOOM:["Acercar/alejar"],SPLASH_UPLOAD:["Carga tu imagen"],SPLASH_UPLOAD_DESCRIPTION:["Carga una foto de tu biblioteca o arrástrala y suéltala"],SPLASH_WEBCAM:["Cámara web"],SPLASH_WEBCAM_DESCRIPTION:["Toma una foto con tu cámara web o tu teléfono"],SPLASH_STOCK:["Imágenes sin derechos de autor"],SPLASH_STOCK_DESCRIPTION:["Selecciona entre miles de fotos sin derechos de autor"],STOCK_SEARCH:["Busca fotos"],STOCK_SEARCH_RESULTS:["Resultados de la búsqueda de ","${query}"],BUTTONS_BACK:["Atrás"],BUTTONS_CANCEL:["Cancelar"],BUTTONS_COLOR:["Color"],LOADING_RESIZING:["Cambiando tamaño..."],LOADING_EXPORTING:["Guardando..."],LOADING_LOADING:["Cargando..."],WARNINGS_RESIZED:["Se cambió el tamaño de la imagen"],WARNINGS_MAX_SIZE:["Tu imagen supera el tamaño máximo de ","${maxMegaPixels}"," megapíxeles, por lo que se cambió su tamaño a ","${width}","×","${height}"," píxeles."],WARNINGS_LIMIT_SIZE:["Debido a limitaciones de hardware, se cambió el tamaño de tu imagen a ","${width}","×","${height}"," píxeles."],ERRORS_LOADING:["No se pudo cargar la imagen"],ERRORS_LOADING_MESSAGE:["No se pudo cargar la imagen en ","${path}"],ERRORS_WEBCAM_UNAVAILABLE:["La cámara web no está disponible"],ERRORS_WEBCAM_UNAVAILABLE_MESSAGE:["No se puede mostrar la imagen de la cámara web (Error: ","${error}",")"],ERRORS_WEBCAM_NOT_SUPPORTED:["La cámara web no es compatible"],ERRORS_WEBCAM_NOT_SUPPORTED_MESSAGE:["La función de la cámara web no es compatible con tu navegador."],ERRORS_RENDER:["Error durante el procesamiento"],ERRORS_RENDER_MESSAGE:["Ocurrió un error al procesar la imagen."],ERRORS_BROWSER:["Ocurrió un error"],ERRORS_BROWSER_MESSAGE:["Tu navegador demoró demasiado para procesar la imagen. Prueba aplicando menos operaciones."],ERRORS_BROWSER_MULTIPLE_MESSAGE:["Tu navegador demoró demasiado para procesar la imagen. Prueba aplicando menos operaciones."],ERRORS_STICKERS_LOAD:["No se pudieron cargar los stickers"],RETRY_DIALOG_MESSAGE:["Esto está tardando más de lo habitual. ¿Quieres guardar los cambios y volver a intentarlo?"],SAVE_PHOTO:["Guardar esta foto"],IMAGE_TOO_LARGE:["Lo sentimos, pero no se puede editar esta imagen porque es muy grande. Vuelve a intentarlo con una imagen de menos de 50 megapíxeles."],NO_ORIGINAL_PHOTO:["No se pudo obtener la foto original. Vuelve a intentarlo."],CROSS_PLATFORM_EDIT_WARNING:["Esta foto se editó por última vez en un dispositivo móvil. Si decides reemplazar esta foto, ya no podrás deshacer las ediciones que hayas hecho hasta el momento en tu dispositivo móvil."],SAVE:["Guardar una copia nueva"],EDIT:["Editar"],NO_VIDEOS_IN_EDITOR:["Los videos no se pueden editar con el editor de fotos de Flickr"],ERROR:["Se produjo un error con el editor de fotos. Vuelve a intentarlo."],FLICKR_PHOTO_EDITOR:["Editor de fotos de Flickr"],CATEGORY_SHAPES:["Formas"],CATEGORY_FOOD:["Comida y bebidas"],CATEGORY_FUN:["Cosas divertidas"],CATEGORY_WEAR:["Ropa y accesorios"],STICKER_SQUARE_OUTLINE:["Contorno cuadrado"],STICKER_CIRCLE_OUTLINE:["Contorno circular"],STICKER_ARROW:["Flecha"],STICKER_TRIANGLE_OUTLINE:["Contorno triangular"],STICKER_LIGHTNING:["Iluminación"],STICKER_X:["X"],STICKER_HEART:["Corazón"],STICKER_STAR:["Estrella"],STICKER_BACON:["Tocino"],STICKER_BANANA:["Plátano"],STICKER_BUBBLE_TEA:["Té de burbujas"],STICKER_CAN:["Lata"],STICKER_CHERRY:["Cereza"],STICKER_COFFEE:["Café"],STICKER_HOT_SAUCE:["Salsa caliente"],STICKER_ICE:["Hielo"],STICKER_LOLLIPOP:["Paleta"],STICKER_MUSHROOM:["Hongo"],STICKER_POPCORN:["Palomitas"],STICKER_ROOTBEER:["Cerveza de raíz"],STICKER_SPORK:["Tenedor-cuchara"],STICKER_BUBBLE_BLUE:["Burbuja azul"],STICKER_BUBBLE_PINK:["Burbuja rosa"],STICKER_DIAMOND:["Diamante"],STICKER_DICE:["Dado"],STICKER_FIRE:["Fuego"],STICKER_FLAMINGO:["Flamenco"],STICKER_FLOWER_ROSE:["Rosa"],STICKER_FLOWER_TULIP:["Tulipán"],STICKER_GIFT_BOX:["Caja de regalo"],STICKER_MONEYBAG:["Bolsa de dinero"],STICKER_RAINBOW:["Arcoíris"],STICKER_SKULL:["Calavera"],STICKER_TICKET:["Boleto"],STICKER_BOBBLES:["Antenas"],STICKER_CROWN:["Corona"],STICKER_GLASSES_RAYBAND:["Lentes de diseñador"],STICKER_GLASSES_SPARKLE:["Lentes brillantes"],STICKER_GOOGLY_EYE:["Ojos saltones"],STICKER_LIPS:["Labios"],STICKER_MUSTACHE:["Bigotes"],STICKER_PARTY_HAT_STARS:["Sombrero para fiestas con estrellas"],STICKER_PARTY_HAT_STRIPES:["Sombrero para fiestas con rayas"],STICKER_TONGUE:["Lengua"],STICKER_VIKING:["Casco de vikingo"],SELECTIVE_BLUR_RADIUS:["Radio desenfocado"],SELECTIVE_BLUR_THICKNESS:["Grosor"],FRAME_NONE:["Sin marco"],FRAME_SCALE:["Escala"]})},"@VERSION@",{requires:["intl"]});